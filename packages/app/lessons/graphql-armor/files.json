{"README.svx":{"file":{"contents":"---\ntitle: GraphQL Armor\n---\n\n# GraphQL Armor\n\n[GraphQL Armor](https://github.com/Escape-Technologies/graphql-armor) is a library that helps you protect your GraphQL API from malicious queries and mutations. It runs on all major GraphQL engines without configuration, and adds various security features to your GraphQL API.\n\nThis tutorial will show you how to install GraphQL Armor and what it can do for you.\n\n## Unlimited query complexity\n\nGraphQL engines ship without complexity limits by default, allowing you to ship complex applications rapidly, but also enabling attackers to perform expensive queries. Cycles in the graph can lead to arbitrarily deep queries, which cause degraded performance or even denial of service.\n\nThis tutorial contains a *very* simple social network with users and friends. Because users have friends and friends have friends, it is possible to construct a query that will cause the server to run out of memory:\n\n```graphql\nquery {\n  user(id: 1) {\n    friends {\n      friends {\n        friends {\n          friends {\n            friends {\n              # ... as deep as the attacker wants\n            }\n          }\n        }\n      }\n    }\n  }\n}\n```\n\nThis attack is one of the many that GraphQL Armor can protect you from.\n\n<Task>\n\n  Your first task is to perform the attack described above. You can use the GraphQL Playground to do this.\n\n  - [ ] Install dependencies with `npm install`\n  - [ ] Run the server with `npm start`\n  - [ ] Send a deep query to the server\n\n  Note: the server is running directly inside your browser, don't make it crash!\n\n</Task>\n\n## Installing GraphQL Armor\n\nGraphQL Armor is a collection of plugins that prevent malicious queries such as the one you sent before.\n\n<Task>\n\n  Your second task is to install GraphQL Armor and protect your server from the attack.\n\n  - [ ] Install GraphQL Armor with `npm install @escape.tech/graphql-armor`\n  - [ ] Add `EnvelopArmorPlugin` to the list of plugins in `index.ts`\n  - [ ] Resend the query to the server and see that it is now protected\n\n</Task>\n\nCongratulations! ðŸŽ‰\n\n## Closing words\n\nYou can read more about GraphQL Armor and all its protections [on GitHub](https://github.com/Escape-Technologies/graphql-armor).\n"}},"package.json":{"file":{"contents":"{\n  \"name\": \"graphql-armor-lesson\",\n  \"private\": true,\n  \"type\": \"module\",\n  \"scripts\": {\n    \"start\": \"tsx watch --clear-screen=false src/index.ts\"\n  },\n  \"dependencies\": {\n    \"@graphql-yoga/render-graphiql\": \"latest\",\n    \"graphql\": \"latest\",\n    \"graphql-yoga\": \"latest\",\n    \"tsx\": \"latest\"\n  }\n}\n"}},"src":{"directory":{"index.ts":{"file":{"contents":"import { createYoga } from 'graphql-yoga';\nimport { renderGraphiQL } from '@graphql-yoga/render-graphiql';\nimport { createServer } from 'node:http';\nimport { schema } from './schema.js';\n\nconst yoga = createYoga({\n  schema,\n  renderGraphiQL,\n  graphiql: {\n    defaultQuery: /* GraphQL */ `\n      query {\n        user(id: 1) {\n          id\n          name\n        }\n      }\n    `,\n  },\n  plugins: [\n    // Add plugins here!\n  ],\n});\n\nconst server = createServer(yoga);\n\nserver.listen(4000, () => {\n  console.info('Server is running on http://localhost:4000/graphql');\n});\n"}},"schema.ts":{"file":{"contents":"import { createSchema } from 'graphql-yoga';\nimport { getFriends, getUser, User } from './users.js';\n\nexport const schema = createSchema({\n  typeDefs: /* GraphQL */ `\n    type Query {\n      hello: String\n      user(id: ID!): User\n    }\n\n    type User {\n      id: ID!\n      name: String\n      friends: [User]\n    }\n  `,\n  resolvers: {\n    Query: {\n      user: (_, { id }): User => getUser(id),\n    },\n    User: {\n      id: (user: User) => user.id,\n      name: (user: User) => user.name,\n      friends: (user: User) => getFriends(user.id),\n    },\n  },\n});\n"}},"users.ts":{"file":{"contents":"/** A mock database table of users. */\nconst users = [\n  { name: 'Alice', friends: [1, 3, 4] },\n  { name: 'Bob', friends: [0, 2, 3] },\n  { name: 'Charlie', friends: [1, 3, 4] },\n  { name: 'Dan', friends: [0, 1, 2, 4] },\n  { name: 'Eve', friends: [0, 2, 3] },\n];\n\n/** Our user type, as resolved in GraphQL. */\nexport type User = { id: number; name: string };\n\n/** `SELECT id, name FROM users WHERE id=:id` */\nexport const getUser = (id: number): User => ({ id, name: users[id].name });\n\n/** Performs a one-to-many lookup for friends. */\nexport const getFriends = (id: number): User[] =>\n  users[id].friends.map(getUser);\n"}}}}}